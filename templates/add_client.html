{% extends "base.html" %}

{% block title %}Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="fas fa-user-plus me-2"></i>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                </h4>
            </div>
            <div class="card-body p-4">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label for="name" class="form-label fw-bold">
                                <i class="fas fa-user me-2"></i>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ *
                            </label>
                            <input type="text" class="form-control form-control-lg" id="name" name="name" 
                                   placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" required>
                        </div>
                        <div class="col-md-6 mb-4">
                            <label for="phone" class="form-label fw-bold">
                                <i class="fas fa-phone me-2"></i>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *
                            </label>
                            <div class="input-group">
                                <select class="form-select form-select-lg" id="country_code" style="max-width: 120px;">
                                    <option value="+966">ğŸ‡¸ğŸ‡¦ +966</option>
                                    <option value="+20">ğŸ‡ªğŸ‡¬ +20</option>
                                </select>
                                <input type="tel" class="form-control form-control-lg" id="phone" name="phone" 
                                       placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
                            </div>
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Ù…Ø«Ø§Ù„: 5xxxxxxxx (Ø³Ø¹ÙˆØ¯ÙŠ) Ø£Ùˆ 1xxxxxxxxx (Ù…ØµØ±ÙŠ)
                            </small>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="response" class="form-label fw-bold">
                            <i class="fas fa-comment me-2"></i>Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ *
                        </label>
                        <select class="form-select form-select-lg" id="response" name="response" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</option>
                            <option value="Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø±Ø¶">Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø±Ø¶</option>
                            <option value="Ø±ÙØ¶">Ø±ÙØ¶</option>
                            <option value="ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="ÙŠØ­ØªØ§Ø¬ Ø§ØªØµØ§Ù„ Ø¢Ø®Ø±">ÙŠØ­ØªØ§Ø¬ Ø§ØªØµØ§Ù„ Ø¢Ø®Ø±</option>
                            <option value="ØºÙŠØ± Ù…ØªØ§Ø­">ØºÙŠØ± Ù…ØªØ§Ø­</option>
                            <option value="Ø±Ù‚Ù… Ø®Ø§Ø·Ø¦">Ø±Ù‚Ù… Ø®Ø§Ø·Ø¦</option>
                            <option value="Ù„Ø§ ÙŠØ±Ø¯">Ù„Ø§ ÙŠØ±Ø¯</option>
                            <option value="Ù…Ø´ØºÙˆÙ„">Ù…Ø´ØºÙˆÙ„</option>
                            <option value="Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„">Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„</option>
                            <option value="Ù…Ù‡ØªÙ…">Ù…Ù‡ØªÙ…</option>
                            <option value="ØºÙŠØ± Ù…Ù‡ØªÙ…">ØºÙŠØ± Ù…Ù‡ØªÙ…</option>
                            <option value="ÙŠØ­ØªØ§Ø¬ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª">ÙŠØ­ØªØ§Ø¬ Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="notes" class="form-label fw-bold">
                            <i class="fas fa-sticky-note me-2"></i>Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                        </label>
                        <textarea class="form-control" id="notes" name="notes" rows="4" 
                                  placeholder="Ø£Ø¯Ø®Ù„ Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø­ÙˆÙ„ Ø§Ù„Ø§ØªØµØ§Ù„..."></textarea>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-arrow-right me-2"></i>Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </a>
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="fas fa-save me-2"></i>Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const countryCodeSelect = document.getElementById('country_code');
    const phoneInput = document.getElementById('phone');
    
    // Phone number formatting based on country
    function formatPhoneNumber(value, countryCode) {
        // Remove all non-digits
        let cleaned = value.replace(/\D/g, '');
        
        if (countryCode === '+966') {
            // Saudi format: 5xxxxxxxx
            if (cleaned.startsWith('0')) {
                cleaned = cleaned.substring(1);
            }
            if (cleaned.startsWith('966')) {
                cleaned = cleaned.substring(3);
            }
            // Ensure it starts with 5 for Saudi numbers
            if (cleaned.length > 0 && !cleaned.startsWith('5')) {
                cleaned = '5' + cleaned;
            }
            // Limit to 9 digits for Saudi numbers
            cleaned = cleaned.substring(0, 9);
        } else if (countryCode === '+20') {
            // Egyptian format: 1xxxxxxxxx
            if (cleaned.startsWith('0')) {
                cleaned = cleaned.substring(1);
            }
            if (cleaned.startsWith('20')) {
                cleaned = cleaned.substring(2);
            }
            // Ensure it starts with 1 for Egyptian numbers
            if (cleaned.length > 0 && !cleaned.startsWith('1')) {
                cleaned = '1' + cleaned;
            }
            // Limit to 10 digits for Egyptian numbers
            cleaned = cleaned.substring(0, 10);
        }
        
        return cleaned;
    }
    
    // Update phone number when country code changes
    countryCodeSelect.addEventListener('change', function() {
        const currentValue = phoneInput.value.replace(/\D/g, '');
        const formattedValue = formatPhoneNumber(currentValue, this.value);
        phoneInput.value = formattedValue;
        updatePlaceholder();
    });
    
    // Format phone number on input
    phoneInput.addEventListener('input', function(e) {
        const countryCode = countryCodeSelect.value;
        const formattedValue = formatPhoneNumber(e.target.value, countryCode);
        e.target.value = formattedValue;
    });
    
    // Update placeholder based on country
    function updatePlaceholder() {
        const countryCode = countryCodeSelect.value;
        if (countryCode === '+966') {
            phoneInput.placeholder = '5xxxxxxxx (Ø³Ø¹ÙˆØ¯ÙŠ)';
        } else if (countryCode === '+20') {
            phoneInput.placeholder = '1xxxxxxxxx (Ù…ØµØ±ÙŠ)';
        }
    }
    
    // Initialize placeholder
    updatePlaceholder();
    
    // Auto-focus on name field
    document.getElementById('name').focus();
    
    // Update form submission to include country code
    document.querySelector('form').addEventListener('submit', function(e) {
        const countryCode = countryCodeSelect.value;
        const phoneNumber = phoneInput.value;
        const fullPhoneNumber = countryCode + phoneNumber;
        
        // Create a hidden input for the full phone number
        let hiddenInput = document.getElementById('full_phone');
        if (!hiddenInput) {
            hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.id = 'full_phone';
            hiddenInput.name = 'phone';
            this.appendChild(hiddenInput);
        }
        hiddenInput.value = fullPhoneNumber;
        
        // Remove the original phone input from form submission
        phoneInput.disabled = true;
    });
});
</script>
{% endblock %} 